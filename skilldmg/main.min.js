'use strict';window.onload=initialize;var fSkills,lastSkill;HTMLElement.prototype.setAttributes=function(){if(0<arguments.length&&0==arguments.length%2)for(var c=0;arguments.length>c;c+=2)this.setAttribute(arguments[c],arguments[c+1])};Array.prototype.suffix=function(c){var b=[],a;for(a of this)b.push(a+c);return b};function readFile(c,b){var a=new FileReader;a.readAsText(c.target.files[0]);a.onload=function(d,e,f){return d(e,f)}.bind(null,b,c)}
function getSkill(c){return isNaN(c)?fSkills[c]:Object.values(fSkills)[parseInt(c)]}function fillSkills(){let c=document.getElementById("skills");c.innerHTML="";for(let b in fSkills){let a=fSkills[b];a.Id=a.Id||a["*Id"];let d=document.createElement("option");d.setAttributes("value",a.Id,"name",b);d.innerText=b;"0"==a.Id&&d.setAttribute("selected","");c.appendChild(d)}}function handleSkOpt(c){fSkills&&lastSkill!=c.target.value&&(lastSkill=c.target.value,doSkillCalc(c.target.value,!0))}
function handleNShift(c){fSkills&&/^[0-8]$/.test(c.target.value)&&doSkillCalc(document.getElementById("skills").value,!1)}function handleCNInp(c){fSkills&&/^-?(0|[1-9]\d*)(\.\d+)?$/.test(c.target.value)&&doSkillCalc(document.getElementById("skills").value,!1)}function handleCInp(c){fSkills&&doSkillCalc(document.getElementById("skills").value,!1)}
function doSkillCalc(c,b){void 0==c&&(c=0);void 0==b&&(b=!0);let a=getSkill(c);c=document.getElementById("dtypes");var d=document.getElementById("sklvl").value;let e=document.getElementById("syndmg").value;""==a.EType&&b?(c.value="phys",document.getElementById("mind").value=a.MinDam,document.getElementById("midlv1").value=a.MinLevDam1,document.getElementById("midlv2").value=a.MinLevDam2,document.getElementById("midlv3").value=a.MinLevDam3,document.getElementById("midlv4").value=a.MinLevDam4,document.getElementById("midlv5").value=
a.MinLevDam5,document.getElementById("maxd").value=a.MaxDam,document.getElementById("madlv1").value=a.MaxLevDam1,document.getElementById("madlv2").value=a.MaxLevDam2,document.getElementById("madlv3").value=a.MaxLevDam3,document.getElementById("madlv4").value=a.MaxLevDam4,document.getElementById("madlv5").value=a.MaxLevDam5,document.getElementById("dlen").value=0,document.getElementById("lenlv1").value=0,document.getElementById("lenlv2").value=0,document.getElementById("lenlv3").value=0):b&&(c.value=
a.EType,document.getElementById("mind").value=a.EMin,document.getElementById("midlv1").value=a.EMinLev1,document.getElementById("midlv2").value=a.EMinLev2,document.getElementById("midlv3").value=a.EMinLev3,document.getElementById("midlv4").value=a.EMinLev4,document.getElementById("midlv5").value=a.EMinLev5,document.getElementById("maxd").value=a.EMax,document.getElementById("madlv1").value=a.EMaxLev1,document.getElementById("madlv2").value=a.EMaxLev2,document.getElementById("madlv3").value=a.EMaxLev3,
document.getElementById("madlv4").value=a.EMaxLev4,document.getElementById("madlv5").value=a.EMaxLev5,document.getElementById("dlen").value=a.ELen,document.getElementById("lenlv1").value=a.ELevLen1,document.getElementById("lenlv2").value=a.ELevLen2,document.getElementById("lenlv3").value=a.ELevLen3);b&&(document.getElementById("dshift").value=""==a.HitShift?0:parseInt(a.HitShift));b=[document.getElementById("mind").value,document.getElementById("midlv1").value,document.getElementById("midlv2").value,
document.getElementById("midlv3").value,document.getElementById("midlv4").value,document.getElementById("midlv5").value,document.getElementById("maxd").value,document.getElementById("madlv1").value,document.getElementById("madlv2").value,document.getElementById("madlv3").value,document.getElementById("madlv4").value,document.getElementById("madlv5").value,document.getElementById("dlen").value,document.getElementById("lenlv1").value,document.getElementById("lenlv2").value,document.getElementById("lenlv3").value];
b=calcSkillDamage(c.value,parseInt(d),document.getElementById("dshift").value,parseFloat(e),b);d=((parseFloat(b.min)+parseFloat(b.max))/2/(b.len/25)).toFixed(2);document.getElementById("totaldmg").innerText=`${b.min} ~ ${b.max}`;document.getElementById("dmgpersec").innerText=`${isNaN(d)?0:d} /s`;document.getElementById("totaldmglen").innerText=`${b.len/25} /s`;switch(c.value){case "phys":document.getElementById("totaldmg").setAttribute("class","ctext dColorPhys");document.getElementById("totaldmglen").setAttribute("class",
"ctext dColorPhys");document.getElementById("dmgpersec").setAttribute("class","ctext dColorPhys");break;case "fire":document.getElementById("totaldmg").setAttribute("class","ctext dColorFire");document.getElementById("totaldmglen").setAttribute("class","ctext dColorFire");document.getElementById("dmgpersec").setAttribute("class","ctext dColorFire");break;case "ltng":document.getElementById("totaldmg").setAttribute("class","ctext dColorLtng");document.getElementById("totaldmglen").setAttribute("class",
"ctext dColorLtng");document.getElementById("dmgpersec").setAttribute("class","ctext dColorLtng");break;case "mag":document.getElementById("totaldmg").setAttribute("class","ctext dColorMag");document.getElementById("totaldmglen").setAttribute("class","ctext dColorMag");document.getElementById("dmgpersec").setAttribute("class","ctext dColorMag");break;case "cold":document.getElementById("totaldmg").setAttribute("class","ctext dColorCold");document.getElementById("totaldmglen").setAttribute("class",
"ctext dColorCold");document.getElementById("dmgpersec").setAttribute("class","ctext dColorCold");break;case "pois":document.getElementById("totaldmg").setAttribute("class","ctext dColorPois");document.getElementById("totaldmglen").setAttribute("class","ctext dColorPois");document.getElementById("dmgpersec").setAttribute("class","ctext dColorPois");break;default:document.getElementById("totaldmg").setAttribute("class","ctext ltheme"),document.getElementById("totaldmglen").setAttribute("class","ctext ltheme"),
document.getElementById("dmgpersec").setAttribute("class","ctext ltheme")}}
function calcSkillDamage(c,b,a,d,e){for(var f in e)e[f]=""==e[f]?0:parseInt(e[f]);let [l,n,p,q,r,t,m,u,v,w,x,y,k,z,A,B]=e;e={min:0,max:0,len:0};let g=f=0,h=0;8>=b?h=z*(b-1):8<b&&16>=b?h=A*(b-1):17<=b&&(h=B*(b-1));8>=b?(f=n*(b-1),g=u*(b-1)):8<b&&16>=b?(f=p*(b-1),g=v*(b-1)):16<b&&22>=b?(f=q*(b-1),g=w*(b-1)):22<b&&28>=b?(f=r*(b-1),g=x*(b-1)):29<=b&&(f=t*(b-1),g=y*(b-1));"pois"==c?(e.min=((l+f)*(k+h)/Math.pow(2,8-a)*(1+d/100)).toFixed(2),e.max=((m+g)*(k+h)/Math.pow(2,8-a)*(1+d/100)).toFixed(2)):(e.min=
((l+f)/Math.pow(2,8-a)*(1+d/100)).toFixed(2),e.max=((m+g)/Math.pow(2,8-a)*(1+d/100)).toFixed(2));e.len=k+h;return e}
function handleTxt(c){readFile(c,function(b,a){a=a.target.result;switch(b.target.files[0].name.toLowerCase()){case "skills.txt":if("skill\t"!=a.substring(0,6))return alert("This is not a valid Skills.txt");fSkills=txtLib.parse(a);break;default:return alert("This file is not supported.")}fSkills&&(document.getElementById("upload").style.display="none",document.getElementById("editable").style.display="inline-block",fillSkills(),doSkillCalc(0))})}
function initialize(){document.getElementById("skillsf").addEventListener("change",handleTxt,!1);document.getElementById("skills").addEventListener("mouseup",handleSkOpt,!1);document.getElementById("sklvl").addEventListener("keyup",handleCNInp,!1);document.getElementById("syndmg").addEventListener("keyup",handleCNInp,!1);document.getElementById("dtypes").addEventListener("mouseup",handleCInp,!1);document.getElementById("dshift").addEventListener("keyup",handleNShift,!1);document.getElementById("mind").addEventListener("keyup",
handleCNInp,!1);document.getElementById("midlv1").addEventListener("keyup",handleCNInp,!1);document.getElementById("midlv2").addEventListener("keyup",handleCNInp,!1);document.getElementById("midlv3").addEventListener("keyup",handleCNInp,!1);document.getElementById("midlv4").addEventListener("keyup",handleCNInp,!1);document.getElementById("midlv5").addEventListener("keyup",handleCNInp,!1);document.getElementById("maxd").addEventListener("keyup",handleCNInp,!1);document.getElementById("madlv1").addEventListener("keyup",
handleCNInp,!1);document.getElementById("madlv2").addEventListener("keyup",handleCNInp,!1);document.getElementById("madlv3").addEventListener("keyup",handleCNInp,!1);document.getElementById("madlv4").addEventListener("keyup",handleCNInp,!1);document.getElementById("madlv5").addEventListener("keyup",handleCNInp,!1);document.getElementById("dlen").addEventListener("keyup",handleCNInp,!1);document.getElementById("lenlv1").addEventListener("keyup",handleCNInp,!1);document.getElementById("lenlv2").addEventListener("keyup",
handleCNInp,!1);document.getElementById("lenlv3").addEventListener("keyup",handleCNInp,!1)};
